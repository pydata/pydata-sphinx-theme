<div class="dropdown">
    <button type="button" class="btn btn-primary btn-sm navbar-btn dropdown-toggle" id="version_switcher_button" data-toggle="dropdown">
        {{ release }}
        <span class="caret"></span>
    </button>
    <div id="version_switcher" class="dropdown-menu list-group-flush py-0" aria-labelledby="version_switcher_button">
    <!-- dropdown will be populated by javascript on page load -->
    </div>
</div>

<script type="text/javascript">
// Function to construct the target URL from the JSON components
function buildURL(entry) {
    var template = "{{ switcher_template_url }}";  // supplied by jinja
    template = template.replace("{version}", entry.version);
    return template;
}

// Function to populate the version switcher
(function () {
    // get JSON config
    $.getJSON("{{ switcher_json_url }}", function(data, textStatus, jqXHR) {
        // create the nodes first (before AJAX calls) to ensure the order is
        // correct (for now, links will go to doc version homepage)
        $.each(data, function(index, entry) {
            // if no custom name specified (e.g., "latest"), use version string
            if (!("name" in entry)) {
                entry.name = entry.version;
            }
            // construct the appropriate URL, and add it to the dropdown
            entry.url = buildURL(entry);
            $("#version_switcher").append(`<a class="list-group-item list-group-item-action py-1" href="${entry.url}">${entry.name}</a>`);
        });
        // see if the current page exists in the other versions of the docs
        const filePath = "{{ pagename }}.html",
              version_items = $("#version_switcher").children();
        $.each(version_items, function(index, node) {
            let newUrl = `${node.href}${filePath}`;
            $.ajax({
                type: 'HEAD',
                url: newUrl,
                // update the target URL if it exists
                success: function() {
                    node.setAttribute("href", newUrl);
                }
            });
        });
    });
})();
</script>
