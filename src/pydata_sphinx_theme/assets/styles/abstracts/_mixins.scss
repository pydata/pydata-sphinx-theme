/*********************************************
* SASS Mixins
*********************************************/

/**
 * A consistent box shadow style we apply across elements.
 */
@mixin box-shadow() {
  box-shadow: 0 0.2rem 0.5rem var(--pst-color-shadow),
    0 0 0.0625rem var(--pst-color-shadow) !important;
}

/**
 * create a low opacity background behind object using our variable colors
 */
@mixin background-from-color-variable($color-variable, $opacity: 0.1) {
  // This is a hack to create a light background with controlled opacity
  // using our css color variables
  // ref: https://stackoverflow.com/a/56951626/6734243

  &:before {
    content: "";
    width: 100%;
    height: 100%;
    position: absolute;
    left: 0;
    top: 0;
    background-color: var(#{$color-variable});
    opacity: $opacity;

    // So that hovering over the text within background is still possible.
    // Otherwise the background overlays the text and you cannot click or select easily.
    // ref: https://developer.mozilla.org/en-US/docs/Web/CSS/pointer-events
    pointer-events: none;
  }
}

/**
 * Set background of some cell outputs to white-ish to make sure colors work
 * This is because many libraries make output that only looks good on white
 */
@mixin cell-output-background {
  color: var(--pst-color-on-background);
  background-color: var(--pst-color-text-base);
  border-radius: 0.25rem;
  padding: 0.5rem;
}

/**
 * Consistent styling for links
 **/

//  Thickness of the underline for links
// the default will be either:
//  - 1px
// - 0.0625rem if it's thicker than 1px because the user has changed the text
//   size in their browser
$link-underline-thickness: unquote("max(1px, .0625rem)") !default;
// Offset of link underlines from text baseline
// The default is 3px expressed as ems, as calculated against the default body
// font size (on desktop).
$link-underline-offset: 0.1578em !default;
// Thickness of link underlines in hover state
// The default for each link will be the thickest of the following:
//  - 3px
//  - 0.1875rem, if it's thicker than 3px because the user has changed the text
//    size in their browser
//  - 0.12em (relative to the link's text size)
$link-hover-underline-thickness: unquote("max(3px, .1875rem, .12em)") !default;

//  Ensures links have an underline decoration
@mixin link-decoration {
  text-decoration: underline;

  @if $link-underline-thickness {
    text-decoration-thickness: $link-underline-thickness;
  }

  @if $link-underline-offset {
    text-underline-offset: $link-underline-offset;
  }
}

@mixin link-hover-decoration {
  @if $link-hover-underline-thickness {
    text-decoration-thickness: $link-hover-underline-thickness;
    // Disable ink skipping on underlines on hover. Browsers haven't
    // standardised on this part of the spec yet, so set both properties
    text-decoration-skip-ink: none; // Chromium, Firefox
    text-decoration-skip: none; // Safari
  }
}

// Default link styles
//
// Makes links use the default unvisited, visited, hover and active colours.

@mixin link-style-default {
  &:link {
    color: var(--pst-color-link);
  }

  &:visited {
    color: var(--pst-color-inline-code);
    // TODO: @trallard replace with accent colour
  }

  &:hover {
    color: var(--pst-color-link-hover);
  }

  &:active {
    color: var(--pst-color-link);
  }
  // So that really long links don't spill out of their container
  word-wrap: break-word;
}

// Text link styles
//
// Makes links use the base text colour. Use this mixin for
// navigation components, such as breadcrumbs.

@mixin link-style-text {
  color: var(--pst-color-text-muted);

  &:hover {
    @include link-hover-decoration;
    color: var(--pst-color-link-hover);
  }
}

// Sidebar and TOC links
@mixin link-sidebar-style {
  color: var(--pst-color-text-muted);
  text-decoration: none;

  &:hover {
    color: var(--pst-color-link-hover);
    box-shadow: inset 2px 0px 0px var(--pst-color-link-hover);
    text-decoration: none;
    background-color: transparent;
  }

  &:active {
    color: var(--pst-color-link);
    background-color: transparent;
    box-shadow: inset 2px 0px 0px var(--pst-color-link);
  }
}
