{% set banner_label = _("Announcement") %}
{% set header_classes = ["bd-header-announcement", "container-fluid", "init"] %}
{% set is_remote=theme_announcement.startswith("http") %}
{# If we are remote, add a script to make an HTTP request for the value on page load #}
<script>
function setAnnouncementHeight() {
    const div = document.querySelector(".bd-header-announcement");
    // At least 3rem height
    const autoHeight = Math.min(
      div.offsetHeight,
      3 * parseFloat(getComputedStyle(document.documentElement).fontSize));
    // Set height and vertical padding to 0 to prepare the height transition
    div.style.setProperty("height", 0);
    div.style.setProperty("padding-top", 0);
    div.style.setProperty("padding-bottom", 0);
    div.classList.remove("init");
    // Set height to the computed height with a small timeout to activate the transition
    setTimeout(() => {
      div.style.setProperty("height", `${autoHeight}px`);
      // Wait for a bit more than 300ms (the transition duration) then remove the
      // forcefully set styles and let CSS take over
      setTimeout(() => {
        div.style.removeProperty("padding-top");
        div.style.removeProperty("padding-bottom");
        div.style.removeProperty("height");
        div.style.setProperty("min-height", "3rem");
      }, 320);
    }, 10);
  }
is_remote = {{ is_remote | tojson }};
if (is_remote) {
  document.write(`<aside class="bd-header-announcement d-print-none" aria-label="{{ banner_label }}"></aside>`);
  fetch("{{ theme_announcement }}")
    .then(res => {return res.text();})
    .then(data => {
      if (data.length === 0) {
        console.log("[PST]: Empty announcement at: {{ theme_announcement }}");
        return;
      }
      div = document.querySelector(".bd-header-announcement");
      div.classList.add(...{{ header_classes | tojson }});
      div.innerHTML = `<div class="bd-header-announcement__content">${data}</div>`;
      setAnnouncementHeight();
    })
    .catch(error => {
      console.log("[PST]: Failed to load announcement at: {{ theme_announcement }}");
    });
} else {
  document.write(`<aside class="{{ header_classes | join(' ') }} bd-header-announcement" aria-label="{{ banner_label }}">
      <div class="bd-header-announcement__content">{{ theme_announcement }}</div>
      </aside>`)
  console.log("[PST]: Using local announcement.")
  setAnnouncementHeight();
}
</script>
