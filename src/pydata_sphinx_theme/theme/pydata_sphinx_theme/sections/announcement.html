{% set header_classes = ["bd-header-announcement", "container-fluid", "init"] %}
{% set is_remote=theme_announcement.startswith("http") %}
{# If we are remote, add a script to make an HTTP request for the value on page load #}
{%- if is_remote %}
<script>
document.write(`<div class="bd-header-announcement"></div>`);
fetch("{{ theme_announcement }}")
  .then(res => {return res.text();})
  .then(data => {
    div = document.querySelector(".bd-header-announcement");
    div.classList.add(...{{ header_classes | tojson }});
    div.innerHTML = `<div class="bd-header-announcement__content">${data}</div>`;
    const autoHeight = div.offsetHeight;
    // Set height and vertical padding to 0 to prepare the height transition
    div.style.height = 0;
    div.style.paddingTop = 0;
    div.style.paddingBottom = 0;
    div.classList.remove("init");
    // Set height to the computed height with a small timeout to activate the transition
    setTimeout(() => {
      div.style.height = `${autoHeight}px`;
      // Wait for a bit more than 150ms (the transition duration) then remove the
      // forcefully set styles and let CSS take over
      setTimeout(() => {
        div.style.paddingTop = "";
        div.style.paddingBottom = "";
        div.style.height = "";
      }, 160);
    }, 10);
  })
  .catch(error => {
    console.log("[PST]: Failed to load announcement at: {{ theme_announcement }}");
  });
</script>
{#- if announcement text is not remote, populate announcement w/ local content -#}
{%- else %}
  <div class="{{ header_classes | join(' ') }} bd-header-announcement">
    <div class="bd-header-announcement__content">{{ theme_announcement }}</div>
  </div>
{% endif %}
